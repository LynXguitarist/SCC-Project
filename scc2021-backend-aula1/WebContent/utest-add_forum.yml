config:
  target: http://localhost:8080/rest
  plugins:
    metrics-by-endpoint: {
      }
    expect: {
      }
  processor: ../test-utils.js
  variables:
    metricsProcessEndpoint: myProcessEndpoint
  phases:
  - duration: 30
    arrivalCount: 30
    name: "Entity does not exist"
  - duration: 30
    arrivalCount: 30
    name: "Create forum"
scenarios:
- name: Entity does not exist
  weight: 1
  flow:
  - post:
      url: /forum
      headers:
        Accept: application/json
      json:
        ownerId: "fake"
      expect:
      - statusCode: 409
- name: Create forum
  weight: 1
  flow:
    - function: genNewEntity
    - post:
        url: /entity
        headers:
          Accept: application/json
        json:
            name: "{{ name }}"
            description: "{{ description }}"
        afterResponse: replyPostEntity
        capture:
          json: $.id
          as: entityId
        expect:
            - statusCode: 204
    - post:
        url: "/forum/"
        headers:
            Accept: application/json
        json:
            ownerId: "{{ entityId }}"
        capture:
          json: $.id
          as: forumId
        expect:
        - statusCode: 204
    - get:
        url: "/forum/{{ forumId }}"
        expect:
          statusCode: 204